<link rel="import" href="/lib/polymer/1.0.9/polymer/polymer.html">
<link rel="import" href="/lib/polymer/1.0.9/iron-autogrow-textarea/iron-autogrow-textarea.html">
<link rel="import" href="/lib/polymer/1.0.9/iron-localstorage/iron-localstorage.html">
<link rel="import" href="/lib/polymer/1.0.9/iron-form/iron-form.html">
<script type="module" src="structuredInput.js?v3"></script>

<dom-module id="precious-textarea">
  <template>
    <iron-localstorage name="{{id}}" value="{{msg}}"></iron-localstorage>
    <iron-autogrow-textarea
      name="msg"
      value="{{msg}}"
      rows="2"
      style='width: 100%'
      speech="on"></iron-autogrow-textarea>
  </template>
  <script>
   Polymer({
     is: "precious-textarea",
     properties: {
       id: {type: String, notify: true}
     },
     clear: function() {
       this.msg = null;
     }
   });
  </script>
</dom-module>


<dom-module id="diary-bot-entry">
  <template>
    <style>
     #status {
         white-space: pre-line;
      }
    </style>
    <h2>{{botName}}</h2>
    <div><a href="{{botName}}/history/recent">history</a></div>
    <div id="status">{{status}}</div>
    <div>New entry:

      <span class="autotext">
        <structured-input botname="{{botName}}" config="{{structuredInput}}"></structured-input>
      </span>

    </div>
    <form is="iron-form" class="text-form" method="POST" action="{{botName}}/message" on-iron-form-response="onResponse">
      <div>
        <precious-textarea id="unsent-{{botName}}"></precious-textarea>
      </div>
      <div><input type="submit" value="Send"></div>
    </form>
  </template>
  <script>
   Polymer({
       is: "diary-bot-entry",
       properties: {
           botName: {type: String},
           status: {type: String},
           structuredInput: {type: Object}
       },
       onResponse: function(ev) {
           if (ev.detail.status == 200) {
               this.querySelector('precious-textarea').clear();
               document.body.textContent = 'saved';
           }
       }
   });
  </script>
</dom-module>
