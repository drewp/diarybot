<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
xmlns:py="http://genshi.edgewall.org/">
  <head>
    <title>diarybot</title>
    <style type="text/css" media="all">
      /* <![CDATA[ */
      form {
	  margin-left: 20px;
	  margin-bottom: 30px;
      }
      /* ]]> */
    </style>
  </head>
  <body>
    <h1>Diarybot</h1>

    <py:for each="bot in bots">
    <h2>${bot.name}</h2>
    <div><a href="${bot.name}/history/recent">history</a></div>
    <form method="POST" action="${bot.name}/message">
      <div>${bot.getStatus()}</div>
      <div>New entry:</div>
      <div><textarea name="msg" rows='3' style='line-height:1; font-size: 100%; width: 300px'> </textarea></div>
      <div><input type="submit" value="Send"></input></div>
    </form>
    </py:for>

    ${Markup(loginBar)}

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"> </script>
<script type="text/javascript">
// <![CDATA[
(function(J)
{
    /**
     * Auto-growing textareas; technique ripped from Facebook
     *
     * http://github.com/jaz303/jquery-grab-bag/tree/master/javascripts/jquery.autogrow-textarea.js
     */
    J.fn.autogrow = function(options)
    {
        return this.filter('textarea').each(function()
        {
            var self                                = this;
            var Jself                               = J(self);
            var minHeight                           = Jself.height();
            var noFlickerPad                        = Jself.hasClass('autogrow-short') ? 0 : parseInt(Jself.css('lineHeight'));

            var shadow = J('<div></div>').css({
                position:   'absolute',
                top:        -10000,
                left:       -10000,
                width:      Jself.width(),
                fontSize:   Jself.css('fontSize'),
                fontFamily: Jself.css('fontFamily'),
                fontWeight: Jself.css('fontWeight'),
                lineHeight: Jself.css('lineHeight'),
                resize:     'none'
            }).appendTo(document.body);

            var update = function()
            {
                var times = function(string, number)
                {
                    for (var i=0, r=''; i<number; i++) r += string;
                    return r;
                };

                var val = self.value.replace(/</g, '&lt;')
                                    .replace(/>/g, '&gt;')
                                    .replace(/&/g, '&amp;')
                                    .replace(/\n$/, '<br/>&nbsp;')
                                    .replace(/\n/g, '<br/>')
                                    .replace(/ {2,}/g, function(space){ return times('&nbsp;', space.length - 1) + ' ' });

                shadow.css('width', Jself.width());
                shadow.html(val);
                Jself.css('height', Math.max(shadow.height() + noFlickerPad, minHeight));
            }

            Jself.change(update).keyup(update).keydown(update);
            J(window).resize(update);

            update();
        });
    };
})(jQuery);

jQuery("textarea").autogrow();

// ]]>
</script>

  </body>
</html>
